# 奇安信威胁情报MCP服务配置手册v2.0.0
## 版本信息
| 版本   | 修订日期   | 说明                   | 修订人 | 审核人 |
|--------|------------|------------------------|--------|--------|
| v2.0.0 | 2025-09-03 | 增加威胁行为体接口说明       | 张思怡   | 白敏  |
| v1.0.1 | 2025-05-13 | 增加推荐的接入方式        | 高健涛   | 白敏   |
| v1.0.0 | 2025-04-29 | 文档初版发布           | 高健涛   | 白敏   |


## 一、服务概述
奇安信威胁情报MCP服务基于模型上下文协议（Model Context Protocol），支持以下协议接入：

| 协议类型 | 是否支持 | 推荐情况 | 说明 |
|----------|----------|----------|------|
| stdio | ❌不支持 | - | 标准输入输出协议 |
| SSE | ✅支持 | - | 服务器推送事件协议 |
| Streamable HTTP | ✅支持 | ✅优先推荐 | 流式HTTP协议，性能更优 |

注：Streamable HTTP协议在性能和稳定性上表现更佳，建议优先选择。

## 二、服务核心优势
### 1. **海量数据基础支撑**
奇安信威胁情报中心构建了全球领先的威胁情报数据生态，覆盖**多维度安全数据资产**：
- **样本与行为数据**  
  累计存储 **300亿+ 行为样本库**，每日新增 **900万+ 样本数据**（包含恶意软件、网络攻击载荷等）  
- **网络空间测绘数据**  
  拥有 **国内最大存活网址库**，每日处理 **300亿条 URL 查询请求**，DNS解析记录总量达 **90亿+**（日增300万+）  
- **漏洞情报数据**  
  维护全球规模最大的 **中文漏洞库**，总量超 **60万+**，每日新增 **500+ 漏洞特征**（含0day漏洞追踪）  

### 2. **实时威胁处理能力**
- **流式数据处理**  
  支持 **400万+/日 明文威胁情报**实时推送，兼容 **600万+ 高价值威胁指标**的秒级检索与阻断（如挖矿、勒索软件、APT攻击等）  
- **精准威胁检测**  
  依托 **99.99% 检测准确率**模型（Gartner验证），实现 **12类威胁场景**全覆盖，包括APT组织追踪、失陷主机识别、钓鱼邮件分析等  

### 3. **高级威胁分析体系**
- **APT追踪能力**  
  持续跟踪分析 **44个国际APT组织**，累计发现并命名 **14个APT组织**（如海莲花、DarkHotel），监测到针对国内的 **47个攻击团伙活动**  
- **威胁行为体全景画像**   
  **800+全球威胁行为体**，覆盖APT组织、勒索团伙、网络犯罪集团等类型，提供IOC、漏洞CVE、报告链接、ATT&CK战术、动机、技战法等威胁详情，实现威胁全景画像分析
- **情报生产闭环**  
  通过 **Q-TDE检测引擎**与 **AI自动化研判机制**，每日生成 **9000+ 新增威胁情报**，并与态势感知、NGFW等 **200+ 安全产品深度集成**  

### 4. **行业权威认证**
- **市场地位**  
  连续3年蝉联 **IDC中国安全分析和情报市场份额第一**（2020-2023），入选Gartner《威胁情报市场指南》核心推荐厂商  
- **服务规模**  
  已为**运营商**头部客户提供 **2000万历史存量+400万/日增量**威胁情报数据服务，支撑 **15.8%年复合增长率**的全球市场扩张  
## 三、接入准备工作
1. **客户端工具要求**  
   - 安装支持MCP协议的工具（推荐选择）：
     - *DeepChat*（版本≥0.0.15）
     - *Cherry Studio*（版本≥1.2.7）
     - 其他支持MCP服务器的任何工具

2. **获取认证凭证**  
   联系奇安信威胁情报平台管理员(ti_support@qianxin.com)获取：
   - **API Key认证说明**
     - 用途：用于请求头认证
     - 默认协议：Streamable HTTP
     - 🌟🌟🌟特殊说明：如需使用SSE协议，请在申请时特别注明
   - 协议接口地址：
     
     | 协议类型 | URL |
     |----------|-----|
     | Streamable HTTP | https://mcp.ti.qianxin.com/ti-stream-mcp |
     | SSE | https://mcp.ti.qianxin.com/ti-mcp/sse |
     
     注：SSE与Streamable HTTP在URL路径中的细微差异为 `ti-mcp` 与 `ti-stream-mcp`。

## 四、配置步骤
### 方式一：[DeepChat客户端](https://github.com/CherryHQ/cherry-studio)配置
1. **添加MCP服务器**
   - 进入 *设置 > MCP设置 > 添加服务器 > 跳过手动配置*
   - 填写参数：
     ```yaml
     服务器名称：QianXin_TI
     服务器类型：SSE 或 Streamable HTTP（根据场景选择）
     基础URL：对应协议地址
     认证密钥：Api-Key=your_api_key_here
     ```
   - 参考[网页14]的JSON配置示例：
     ```json
     {
        "mcpServers": {
            "QianXin_TI": {
                "type": "根据场景选择接入方式",
                "url": "接入方式对应的URL",
                "headers": {"Api-Key": "your_api_key"}
            }
        }
     }
     ```

2. **启用服务**
   - 在聊天界面底部打开 *MCP服务开关*
   - 选择已配置的「QianXin_TI」服务

### 方式二：[Cherry Studio](https://github.com/CherryHQ/cherry-studio)配置

1. **服务添加流程**
   - 进入 *设置 > MCP服务器 > 添加服务器*
   - 选择协议类型后填写：
     ```bash
     名称：奇安信威胁情报MCP云服务
     类型：SSE/Streamable HTTP
     URL：对应协议地址
     认证头：{"Api-Key":"your_key"} 
     ```

## 五、安全认证说明
1. **请求头认证机制**  
   所有请求需在Header中包含：
   ```http
   Api-Key: your_api_key_here
   ```
   - 密钥通过奇安信控制台动态管理
   - 支持IP白名单绑定（需单独申请）

2. **安全增强措施** 
   - 基于SSL/TLS加密传输
   - 访问控制及必要的频率限制
   - 会话ID跟踪机制（Streamable HTTP模式下自动关联`Mcp-Session-Id`）



## 六、详细使用示例
### 1、优化建议(系统提示语)
- 为了提升数据准确性，我们提供了以下优化建议：
  - 模型侧配置系统提示词：
    ```
    请遵循以下规范：
    1.MCP数据优先原则：在使用过程中，请严格优先使用 MCP 数据，所有回答必须基于 MCP 查询结果，即便与您原有的知识存在冲突。
    2.时效性声明：每次使用 MCP 提供信息时，务必在回答开头标注 “根据 MCP 最新数据（{日期}）”，以确保信息的时效性。
    3.避免旧知干扰：若 MCP 已有明确结果，禁止使用 “可能”“我记得” 等不确定表述，保证信息传递的准确性和权威性。
    ```


### 2、以下是奇安信威胁情报MCP服务支持的**16个核心查询场景及示例**的简洁总结表格：

---

| 函数命名                   | 函数描述                                                                 | 场景示例                                                                                   |
|----------------------------|--------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
| `query_vuln_by_id`         | 通过CVE/CNNVD/CNVD编号查询漏洞详情                                      | "分析CVE-2024-28677的利用方式，输出修复优先级和威胁等级"                                 |
| `batch_query_vulns`        | 批量查询最多5个漏洞的威胁差异分析                                       | "对比CVE-2021-1234和CVE-2021-5678的攻击链利用频率，输出共性TTPs战术"                    |
| `query_ip`                 | 单IP信誉评估及攻击团伙分析                                              | "验证IP 1.1.1.1是否属于DarkHotel组织的C2服务器，输出地理位置标签"                        |
| `batch_query_ips`          | 批量IP画像（最多5个）及恶意标签聚类                                     | "分析IP列表[1.1.1.1, 2.2.2.2]的IDC分布，关联挖矿活动"                                   |
| `query_hash`               | 文件哈希恶意性检测与沙箱行为分析                                        | "检测02aad2790b101d359e5216f9397ccba4是否银狐木马变种，提取C2通信域名"                                |
| `batch_query_hashes`       | 批量样本对比（最多5个）及同源性判断                                     | "对比[hash1, hash2]的沙箱行为相似度，判断是否同源攻击"                                   |
| `query_ioc_graph`          | IOC关联图谱分析（支持IP/域名/URL/哈希）                                 | "溯源example.com的DNS历史记录，关联APT-C-36组织攻击事件"                                 |
| `query_domain`             | 域名威胁标签验证及解析记录追踪                                           | "验证test.com是否被标记为钓鱼域名，输出最近解析IP"                                       |
| `batch_query_domains`      | 批量域名检测（最多5个）及风险评分                                       | "评估[test.com, ddns.net]的钓鱼概率，输出DNS注册商风险"                                 |
| `query_domain_graph`       | 域名攻击链可视化（关联IP/样本/APT活动）                                 | "分析evil.xyz的隐蔽隧道通信行为，关联挖矿活动和横向渗透路径"                             |
| `query_ip_graph`           | IP资产画像与横向移动路径分析                                            | "追踪185.172.111.212的端口扫描行为，定位关联恶意域名net.spoofedoxy.net"                     |
| `query_hash_graph`         | 样本哈希关联分析（揭示C2基础设施）                                      | "通过样本d752a467...关联鱼叉邮件发信IP列表，生成攻击者画像"                              |
| `query_vuln_list_by_keyword` | 漏洞关键词模糊搜索（支持产品/组件名称）                                | "查找Nginx近3年所有高危RCE漏洞"                                          |
| `query_vuln_list`          | 多条件组合漏洞搜索（时间/等级/修复状态/APT关联等20+维度）               | "检索2025年存在在野利用的已修复零日漏洞"                                        |
| `query_vuln_list`          | 多条件组合漏洞搜索（时间/等级/修复状态/APT关联等20+维度）               | "检索2025年存在在野利用的已修复零日漏洞"                                        |
|`query_threat_actor_by_ioc` |IOC关联威胁行为体画像检索|“查询video.cnhardware.info  关联威胁行为体画像信息”
|`query_threat_actor_list` |多条件组合威胁行为体检索（组织别名/组织类型/攻击频率/影响行业/疑似来源/最近活动时间）|“查询海莲花的威胁行为体画像信息”<br>“查询CLOP威胁行为体漏洞、IOC、安全报告”<br>“Dire Wolf的主要攻击手法是什么？”<br>“查询最近6个月内攻击频率高的组织”<br>“列举最近活跃的黑客组织有哪些？主要的攻击动机是什么？”<br>“哪些组织曾使用过Cobalt Strike进行攻击活动？”<br>“列举疑似来自美国的APT组织及组织攻击详情？”

## 七、MCP应用场景
通过 **TI INSIDE MCP** 接入计划，奇安信威胁情报可赋能以下场景：
1. **安全设备增强**：为防火墙、检测类设备提供实时IOC阻断规则  
2. **威胁发现**：基于关键ioc特征，挖掘潜在的威胁
3. **风险决策**：通过漏洞情报服务输出可行动修复建议 
4. **安全运营**：基于威胁情报服务提升安全运营效率
5. **威胁全景画像**：解读攻击组织背景、动机及历史活动，提供基于威胁行为体的全景画像，帮助安全团队预测潜在威胁并制定针对性防御策略
---
**配置支持**：更多技术细节可参考奇安信威胁分析平台文档或联系ti_support@qianxin.com

注：本手册基于2025年4月协议版本编写，配置界面以实际工具版本为准。建议定期检查[奇安信威胁情报中心](https://ti.qianxin.com/)获取更新说明。
